<html>
<head>
    <title>Sign In</title>
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>
    <div class="signup-container" style="max-width:400px;margin:60px auto;padding:32px 24px;background:#fff;border-radius:8px;box-shadow:0 2px 12px #0001;">
        <h2 style="text-align:center;">Sign In</h2>
        <form id="signinForm" style="margin-bottom:24px;">
            <input type="text" name="username" id="username" placeholder="Username or Email" required style="width:100%;margin-bottom:12px;padding:10px;" />
            <input type="password" name="password" id="password" placeholder="Password" required style="width:100%;margin-bottom:12px;padding:10px;" />
            <button type="submit" style="width:100%;padding:10px;background:#007bff;color:#fff;border:none;border-radius:4px;font-size:16px;">Sign In</button>
        </form>
        <div id="signinMessage" style="text-align:center;color:#d9534f;margin-bottom:12px;"></div>
        <div style="text-align:center;margin:16px 0;">or</div>
        <a href="/auth/google" style="display:block;text-align:center;margin:0;padding:12px 0;background:#4285F4;color:#fff;font-size:18px;border:none;border-radius:4px;text-decoration:none;">
            <span style="vertical-align:middle;margin-right:8px;" class="material-icons"></span>
            Sign in with Google
        </a>
        <div style="text-align:center;margin:24px 0 0 0;">
            <span>Don't have an account?</span>
            <a href="/signup" style="color:#007bff;text-decoration:underline;margin-left:6px;">Sign up</a>
        </div>
        <script>
        document.getElementById('signinForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('signinMessage');
            messageDiv.textContent = '';
            try {
                const res = await fetch('/users/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();
                if (data.redirect) {
                    window.location.href = data.redirect;
                    return;
                }
                messageDiv.textContent = data.error || 'Login failed.';
            } catch (err) {
                messageDiv.textContent = 'Network error.';
            }
        });
        </script>
    </div>
</body>
</html>
